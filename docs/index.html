<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Notes Flashcards</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;max-width:900px;margin:40px auto;padding:0 16px}
    .deck-select, .card, .controls{margin:12px 0}
    .card{border:1px solid #ddd;border-radius:8px;padding:24px;min-height:160px;display:flex;flex-direction:column;justify-content:center}
    .q{font-size:1.15rem;margin-bottom:12px}
    .a{display:none;color:#0b0;white-space:pre-wrap}
    .show .a{display:block}
    .show .q{opacity:0.6}
    button{margin-right:8px;padding:8px 12px;border-radius:6px}
    .meta{color:#666;font-size:0.9rem;margin-top:8px}
  </style>
</head>
<body>
  <h1>Flashcards — Notes</h1>
  <div class="deck-select">
    <label>Deck:
      <select id="deck">
        <option value="all">All</option>
        <option value="algorithm">algorithm</option>
        <option value="devops">devops</option>
        <option value="machine-learning">machine-learning</option>
        <option value="system-design">system-design</option>
        <option value="leetcode">leetcode</option>
        <option value="agentic">agentic</option>
      </select>
    </label>
  </div>

  <div id="cardArea" class="card">
    <div class="q" id="q">Loading…</div>
    <div class="a" id="a"></div>
    <div class="meta" id="meta"></div>
  </div>

  <div class="controls">
    <button id="show">Show Answer</button>
    <button id="again">Again</button>
    <button id="good">Good</button>
    <button id="easy">Easy</button>
    <button id="prev">◀ Prev</button>
    <button id="next">Next ▶</button>
  </div>

<script>
const DATA_PATH = './artifacts/flashcards.json';
let allCards = [];
let filtered = [];
let idx = 0;

function saveState(){ localStorage.setItem('flash_state', JSON.stringify({idx,deck:document.getElementById('deck').value})); }
function loadState(){ try{ const s=JSON.parse(localStorage.getItem('flash_state')||'{}'); if(s.idx) idx=s.idx; if(s.deck) document.getElementById('deck').value=s.deck;}catch(e){} }

async function load(){
  const res = await fetch(DATA_PATH);
  allCards = await res.json();
  applyFilter();
  loadState();
  showCard();
}

function applyFilter(){
  const deck = document.getElementById('deck').value;
  filtered = (deck==='all')? allCards.slice() : allCards.filter(c=>c.category===deck);
  if(filtered.length===0){ document.getElementById('q').textContent='No cards in this deck.'; document.getElementById('a').textContent=''; }
  if(idx>=filtered.length) idx = 0;
}

function renderMeta(c){ return `Category: ${c.category} • Source: ${c.source}` }

function showCard(){
  if(!filtered || filtered.length===0) return;
  const c = filtered[idx];
  document.getElementById('q').textContent = c.q;
  document.getElementById('a').textContent = c.a;
  document.getElementById('meta').textContent = renderMeta(c);
  document.getElementById('cardArea').classList.remove('show');
  saveState();
}

document.getElementById('show').addEventListener('click', ()=>{ document.getElementById('cardArea').classList.add('show'); });
document.getElementById('next').addEventListener('click', ()=>{ idx=(idx+1)%filtered.length; showCard(); });
document.getElementById('prev').addEventListener('click', ()=>{ idx=(idx-1+filtered.length)%filtered.length; showCard(); });
document.getElementById('again').addEventListener('click', ()=>{ nextAfterGrade(0); });
document.getElementById('good').addEventListener('click', ()=>{ nextAfterGrade(3); });
document.getElementById('easy').addEventListener('click', ()=>{ nextAfterGrade(5); });

function nextAfterGrade(score){
  // rudimentary scheduling: if "good" or "easy", push card later; if "again" keep it close.
  if(!filtered || filtered.length===0) return;
  const c = filtered.splice(idx,1)[0];
  if(score>=3) {
    // push farther: append to end
    filtered.push(c);
  } else {
    // keep it near front: insert 2 positions later
    const insertAt = Math.min(2, filtered.length);
    filtered.splice(insertAt,0,c);
  }
  if(idx>=filtered.length) idx = 0;
  showCard();
}

document.getElementById('deck').addEventListener('change', ()=>{ applyFilter(); idx=0; showCard(); saveState(); });

load();
</script>
</body>
</html>
